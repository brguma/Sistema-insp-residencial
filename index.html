<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inspe√ß√£o Residencial - Completo</title>
    <!-- Google Drive API Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .modal-options {
            display: grid;
            gap: 15px;
        }

        .option-card {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option-card h3 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .option-card p {
            color: #666;
            font-size: 14px;
        }

        .inspection-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .inspection-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .inspection-item:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }

        .inspection-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .inspection-item-date {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .inspection-item-address {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Info Icon Styles */
        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
            position: relative;
        }

        .info-icon:hover {
            background: #764ba2;
        }

        .tooltip {
            display: none;
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
        }

        .info-icon:hover .tooltip {
            display: block;
        }

        /* Main Menu */
        .main-menu {
            padding: 30px;
            display: none;
        }

        .main-menu.active {
            display: block;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .menu-card i {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .menu-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .menu-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Form Styles */
        .inspection-form {
            padding: 30px;
            display: none;
        }

        .inspection-form.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .inspection-type-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-inicial {
            background: #4CAF50;
            color: white;
        }

        .badge-completa {
            background: #FF9800;
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input:disabled,
        .form-group select:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        /* Checklist Styles */
        .checklist-section {
            margin-bottom: 25px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .checklist-header h4 {
            color: #333;
            font-size: 18px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .checklist-item:hover {
            background: #e9ecef;
        }

        .checklist-item-label {
            flex: 1;
            margin-right: 20px;
            color: #555;
            display: flex;
            align-items: center;
        }

        .checklist-options {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .check-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .check-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .check-option label {
            cursor: pointer;
            font-size: 14px;
            color: #666;
        }

        .observation-field {
            margin-top: 10px;
            display: none;
        }

        .observation-field.active {
            display: block;
        }

        .observation-field textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 60px;
        }

        /* Photo Section */
        .photo-section {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border: 2px dashed #667eea;
            border-radius: 8px;
            display: none;
        }

        .photo-section.active {
            display: block;
        }

        .photo-upload-area {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .photo-upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .photo-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .photo-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,0,0,0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Login Screen */
        .login-screen {
            padding: 50px 30px;
            text-align: center;
        }

        .login-screen.active {
            display: block;
        }

        .login-btn {
            background: white;
            color: #667eea;
            padding: 15px 40px;
            border: 2px solid #667eea;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .login-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Sistema de Inspe√ß√£o Residencial</h1>
            <p>Gerenciamento Completo de Vistorias</p>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen active">
            <div style="margin-bottom: 30px;">
                <h2 style="color: #333; margin-bottom: 10px;">Bem-vindo!</h2>
                <p style="color: #666;">Conecte-se com o Google Drive para come√ßar</p>
            </div>
            
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffc107;">
                <p style="color: #856404; font-size: 13px; margin: 0;">
                    ‚ö†Ô∏è <b>Antes de conectar:</b><br/>
                    Certifique-se de ter configurado o CLIENT_ID e API_KEY no c√≥digo HTML.<br/>
                    Consulte o guia em PDF se ainda n√£o configurou.
                </p>
            </div>
            
            <button class="login-btn" onclick="requestAccessToken()">
                üîê Conectar com Google Drive
            </button>
            <p style="margin-top: 20px; color: #999; font-size: 12px;">
                Suas inspe√ß√µes ser√£o salvas com seguran√ßa no Google Drive
            </p>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="main-menu">
            <div class="menu-grid">
                <div class="menu-card" onclick="showInspectionTypeModal()">
                    <i>üìã</i>
                    <h3>Nova Inspe√ß√£o</h3>
                    <p>Criar nova vistoria</p>
                </div>
                <div class="menu-card" onclick="showInspectionsList()">
                    <i>üìÅ</i>
                    <h3>Ver Inspe√ß√µes</h3>
                    <p>Hist√≥rico de vistorias</p>
                </div>
                <div class="menu-card" onclick="showSettings()">
                    <i>‚öôÔ∏è</i>
                    <h3>Configura√ß√µes</h3>
                    <p>Ajustes do sistema</p>
                </div>
            </div>
        </div>

        <!-- Modal: Escolha do Tipo de Inspe√ß√£o -->
        <div id="inspectionTypeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Escolha o Tipo de Inspe√ß√£o</h2>
                    <p style="color: #666; font-size: 14px;">Selecione o tipo de vistoria que deseja realizar</p>
                </div>
                <div class="modal-options">
                    <div class="option-card" onclick="startNewInspection('inicial')">
                        <h3>üèÅ Inspe√ß√£o Inicial</h3>
                        <p>Primeira vistoria do im√≥vel com dados b√°sicos e estruturais</p>
                    </div>
                    <div class="option-card" onclick="showInitialInspectionsList()">
                        <h3>üìä Inspe√ß√£o Completa</h3>
                        <p>Vistoria detalhada - requer inspe√ß√£o inicial pr√©via</p>
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-secondary" onclick="closeInspectionTypeModal()">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal: Sele√ß√£o de Inspe√ß√£o Inicial -->
        <div id="selectInitialModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Selecione a Inspe√ß√£o Inicial</h2>
                    <p style="color: #666; font-size: 14px;">Escolha a inspe√ß√£o inicial deste im√≥vel para continuar</p>
                </div>
                <div id="initialInspectionsList" class="inspection-list">
                    <!-- Lista ser√° preenchida dinamicamente -->
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="continueWithSelectedInspection()" style="margin-right: 10px;">Continuar</button>
                    <button class="btn btn-secondary" onclick="closeSelectInitialModal()">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Inspection Form -->
        <div id="inspectionForm" class="inspection-form">
            <!-- Form will be generated dynamically -->
        </div>
    </div>

    <script>
        // Configuration - SUBSTITUA AQUI SUAS CREDENCIAIS
        const CLIENT_ID = '756155400991-gle9g8l22p3a8h9at5uu5djijtqat9lu.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyDTduz53nKthvO9sR1cvHNmD1DK4IDazlM';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        // Global variables
        let accessToken = null;
        let tokenClient = null;
        let gapiInited = false;
        let gisInited = false;
        let inspections = [];
        let currentInspection = null;
        let currentInspectionType = null;
        let selectedInitialInspection = null;
        let photoData = {};

        // Patologias Info Database
        const patologiasInfo = {
            'fissuras': 'Aberturas na estrutura com menos de 0,5mm de largura. Geralmente causadas por movimenta√ß√£o t√©rmica ou retra√ß√£o do concreto.',
            'trincas': 'Aberturas acima de 0,5mm de largura. Podem indicar problemas estruturais mais s√©rios e requerem aten√ß√£o imediata.',
            'danos': 'Deteriora√ß√£o ou avarias na estrutura que comprometem a integridade do im√≥vel.',
            'recalque': 'Afundamento da funda√ß√£o causando desn√≠veis e rachaduras. Problema estrutural grave.',
            'vazamento': 'Perda de √°gua ou esgoto nas tubula√ß√µes, podendo causar infiltra√ß√µes e danos estruturais.',
            'goteiras': 'Infiltra√ß√£o de √°gua da chuva pela cobertura, causando manchas e mofo.',
            'infiltracao': 'Penetra√ß√£o de umidade nas paredes, pisos ou tetos, causando manchas, mofo e degrada√ß√£o.',
            'manchas': 'Marcas vis√≠veis de umidade, mofo ou deteriora√ß√£o nos acabamentos.',
            'mofo': 'Crescimento de fungos causado por umidade excessiva, prejudicial √† sa√∫de.',
            'cupim': 'Infesta√ß√£o de insetos xil√≥fagos que deterioram madeiras e podem comprometer estruturas.',
            'corrosao': 'Oxida√ß√£o de elementos met√°licos (ferragens, estruturas) que compromete a resist√™ncia.'
        };

        // Initialize Google Drive
        function initializeGoogleDrive() {
            // Verificar se as credenciais foram configuradas
            if (CLIENT_ID === 'YOUR_CLIENT_ID.apps.googleusercontent.com' || API_KEY === 'YOUR_API_KEY') {
                alert('‚ö†Ô∏è ATEN√á√ÉO: Voc√™ precisa configurar suas credenciais do Google Drive!\n\n' +
                      'Por favor, siga o guia em PDF para obter o CLIENT_ID e API_KEY.\n\n' +
                      'Depois, substitua os valores no c√≥digo HTML.');
                return;
            }

            try {
                // Carregar API do Google
                gapi.load('client', initializeGapiClient);
                
                // Inicializar Google Identity Services
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: (tokenResponse) => {
                        if (tokenResponse.error !== undefined) {
                            console.error('Erro na autentica√ß√£o:', tokenResponse);
                            alert('Erro ao conectar com Google Drive. Verifique suas credenciais.');
                            return;
                        }
                        accessToken = tokenResponse.access_token;
                        console.log('‚úÖ Conectado ao Google Drive com sucesso!');
                        showMainMenu();
                    },
                    error_callback: (error) => {
                        console.error('Erro no token client:', error);
                        alert('Erro ao inicializar autentica√ß√£o. Verifique as configura√ß√µes.');
                    }
                });
                
                gisInited = true;
            } catch (error) {
                console.error('Erro ao inicializar:', error);
                alert('Erro ao carregar APIs do Google. Verifique sua conex√£o com a internet.');
            }
        }

        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
                });
                gapiInited = true;
                console.log('‚úÖ Google API Client inicializado');
            } catch (error) {
                console.error('Erro ao inicializar GAPI:', error);
                alert('Erro ao inicializar API do Google Drive. Verifique a API_KEY.');
            }
        }

        function handleCredentialResponse(response) {
            // Fun√ß√£o removida - n√£o √© mais necess√°ria
            console.log('Credential response (legacy - n√£o usado)');
        }

        function requestAccessToken() {
            if (!tokenClient) {
                alert('Sistema n√£o inicializado. Aguarde alguns segundos e tente novamente.');
                return;
            }
            
            if (!gapiInited || !gisInited) {
                alert('APIs ainda est√£o carregando... Aguarde alguns segundos.');
                setTimeout(requestAccessToken, 2000);
                return;
            }
            
            try {
                console.log('üì§ Solicitando token de acesso...');
                // Solicitar token com prompt de consentimento
                tokenClient.requestAccessToken({ 
                    prompt: 'consent',
                    hint: '' // Remove hint que pode causar problemas
                });
            } catch (error) {
                console.error('‚ùå Erro ao solicitar token:', error);
                alert('Erro ao solicitar autoriza√ß√£o. Tente recarregar a p√°gina (F5) e tentar novamente.');
            }
        }

        function showMainMenu() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainMenu').classList.add('active');
            loadInspections();
        }

        // Load inspections from localStorage
        function loadInspections() {
            const stored = localStorage.getItem('inspections');
            if (stored) {
                inspections = JSON.parse(stored);
            }
        }

        // Save inspections to localStorage
        function saveInspections() {
            localStorage.setItem('inspections', JSON.stringify(inspections));
        }

        // Show inspection type modal
        function showInspectionTypeModal() {
            document.getElementById('inspectionTypeModal').classList.add('active');
        }

        function closeInspectionTypeModal() {
            document.getElementById('inspectionTypeModal').classList.remove('active');
        }

        // Start new inspection
        function startNewInspection(type) {
            currentInspectionType = type;
            closeInspectionTypeModal();
            
            if (type === 'inicial') {
                createInspectionForm(type, null);
            }
        }

        // Show list of initial inspections
        function showInitialInspectionsList() {
            const initialInspections = inspections.filter(i => i.type === 'inicial');
            
            if (initialInspections.length === 0) {
                alert('N√£o h√° inspe√ß√µes iniciais cadastradas. Por favor, realize uma inspe√ß√£o inicial primeiro.');
                return;
            }

            const listContainer = document.getElementById('initialInspectionsList');
            listContainer.innerHTML = '';

            initialInspections.forEach(inspection => {
                const item = document.createElement('div');
                item.className = 'inspection-item';
                item.onclick = () => selectInitialInspection(inspection, item);
                
                item.innerHTML = `
                    <div class="inspection-item-date">üìÖ ${formatDate(inspection.dataVistoria)} - ${inspection.horaVistoria}</div>
                    <div class="inspection-item-address">üìç ${inspection.endereco}, ${inspection.numero} - ${inspection.bairro}, ${inspection.municipio}/${inspection.uf}</div>
                `;
                
                listContainer.appendChild(item);
            });

            closeInspectionTypeModal();
            document.getElementById('selectInitialModal').classList.add('active');
        }

        function selectInitialInspection(inspection, element) {
            // Remove selection from all items
            document.querySelectorAll('.inspection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            element.classList.add('selected');
            selectedInitialInspection = inspection;
        }

        function continueWithSelectedInspection() {
            if (!selectedInitialInspection) {
                alert('Por favor, selecione uma inspe√ß√£o inicial.');
                return;
            }

            currentInspectionType = 'completa';
            closeSelectInitialModal();
            createInspectionForm('completa', selectedInitialInspection);
        }

        function closeSelectInitialModal() {
            document.getElementById('selectInitialModal').classList.remove('active');
            selectedInitialInspection = null;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Create inspection form
        function createInspectionForm(type, baseInspection) {
            const formContainer = document.getElementById('inspectionForm');
            const isCompleta = type === 'completa';
            const badge = isCompleta ? 
                '<span class="inspection-type-badge badge-completa">INSPE√á√ÉO COMPLETA</span>' :
                '<span class="inspection-type-badge badge-inicial">INSPE√á√ÉO INICIAL</span>';

            let formHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Nova Inspe√ß√£o ${badge}</h2>
                    <button class="btn btn-secondary" onclick="backToMenu()">‚Üê Voltar</button>
                </div>
            `;

            // Se√ß√£o 1: Dados do Im√≥vel
            formHTML += `
                <div class="form-section">
                    <h3>üìç Dados do Im√≥vel</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Endere√ßo *</label>
                            <input type="text" id="endereco" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.endereco || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>N√∫mero *</label>
                            <input type="text" id="numero" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.numero || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Complemento</label>
                            <input type="text" id="complemento" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.complemento || ''}">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Bairro *</label>
                            <input type="text" id="bairro" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.bairro || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Munic√≠pio *</label>
                            <input type="text" id="municipio" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.municipio || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>UF *</label>
                            <select id="uf" ${isCompleta ? 'disabled' : ''} required>
                                <option value="">Selecione</option>
                                ${getUFOptions(baseInspection?.uf)}
                            </select>
                        </div>
                    </div>
                </div>
            `;

            // Se√ß√£o 2: Data e Respons√°vel
            formHTML += `
                <div class="form-section">
                    <h3>üìÖ Data da Vistoria</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Data da Vistoria *</label>
                            <input type="date" id="dataVistoria" value="${new Date().toISOString().split('T')[0]}" required>
                        </div>
                        <div class="form-group">
                            <label>Hora *</label>
                            <input type="time" id="horaVistoria" value="${new Date().toTimeString().slice(0,5)}" required>
                        </div>
                        <div class="form-group">
                            <label>Quem Acompanhou *</label>
                            <input type="text" id="acompanhante" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.acompanhante || ''}" required>
                        </div>
                    </div>
                </div>
            `;

            // Se√ß√£o 3: Caracter√≠sticas do Im√≥vel
            formHTML += `
                <div class="form-section">
                    <h3>üè† Caracter√≠sticas do Im√≥vel</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Idade do Im√≥vel (anos)</label>
                            <input type="number" id="idadeImovel" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.idadeImovel || ''}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Quantidade de Pavimentos</label>
                            <input type="number" id="qtdPavimentos" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.qtdPavimentos || ''}" min="1">
                        </div>
                        <div class="form-group">
                            <label>Quantidade de Salas</label>
                            <input type="number" id="qtdSalas" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.qtdSalas || ''}" min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Quantidade de Quartos</label>
                            <input type="number" id="qtdQuartos" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.qtdQuartos || ''}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Quantidade de Su√≠tes</label>
                            <input type="number" id="qtdSuites" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.qtdSuites || ''}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Quantidade de Cozinhas</label>
                            <input type="number" id="qtdCozinhas" ${isCompleta ? 'disabled' : ''} value="${baseInspection?.qtdCozinhas || ''}" min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Possui Quintal?</label>
                            <select id="possuiQuintal" ${isCompleta ? 'disabled' : ''}>
                                <option value="nao" ${baseInspection?.possuiQuintal === 'nao' ? 'selected' : ''}>N√£o</option>
                                <option value="sim" ${baseInspection?.possuiQuintal === 'sim' ? 'selected' : ''}>Sim</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Possui Garagem?</label>
                            <select id="possuiGaragem" ${isCompleta ? 'disabled' : ''}>
                                <option value="nao" ${baseInspection?.possuiGaragem === 'nao' ? 'selected' : ''}>N√£o</option>
                                <option value="sim" ${baseInspection?.possuiGaragem === 'sim' ? 'selected' : ''}>Sim</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;

            // Checklists - INSPE√á√ÉO INICIAL
            formHTML += generateChecklist('estrutura', '1 - Estrutura', [
                { id: 'fissuras', label: 'Fissuras', info: 'fissuras' },
                { id: 'trincas', label: 'Trincas', info: 'trincas' },
                { id: 'danos', label: 'Danos', info: 'danos' },
                { id: 'recalque', label: 'Recalque', info: 'recalque' }
            ], baseInspection);

            formHTML += generateChecklist('eletrica', '2 - Instala√ß√µes El√©tricas', [
                { id: 'quadro', label: 'Estado Quadro de Distribui√ß√£o' },
                { id: 'fiacao', label: 'Fia√ß√£o Aparente' },
                { id: 'tomadas', label: 'Tomadas' },
                { id: 'interruptores', label: 'Interruptores' }
            ], baseInspection);

            formHTML += generateChecklist('hidro', '3 - Instala√ß√µes Hidrossanit√°rias', [
                { id: 'vazamento', label: 'Sinais de Vazamento', info: 'vazamento' },
                { id: 'tubulacoes', label: 'Tubula√ß√µes' },
                { id: 'registros', label: 'Registros' },
                { id: 'loucas', label: 'Lou√ßas' },
                { id: 'caixas', label: 'Caixas d\'√°gua' }
            ], baseInspection);

            formHTML += generateChecklist('cobertura', '4 - Cobertura e Impermeabiliza√ß√£o', [
                { id: 'goteiras', label: 'Presen√ßa de Goteiras', info: 'goteiras' },
                { id: 'infiltracoes', label: 'Infiltra√ß√µes', info: 'infiltracao' },
                { id: 'telhado', label: 'Telhado' },
                { id: 'calhas', label: 'Calhas' },
                { id: 'impermeabilizacao', label: 'Impermeabiliza√ß√£o' }
            ], baseInspection);

            formHTML += generateChecklist('revestimento', '5 - Revestimento e Acabamentos', [
                { id: 'paredes', label: 'Paredes' },
                { id: 'pisos', label: 'Pisos' },
                { id: 'pintura', label: 'Pintura' },
                { id: 'azulejos', label: 'Azulejos' },
                { id: 'manchas', label: 'Manchas', info: 'manchas' }
            ], baseInspection);

            formHTML += generateChecklist('esquadrias', '6 - Esquadrias', [
                { id: 'funcionamento', label: 'Funcionamento' },
                { id: 'conservacao', label: 'Estado de Conserva√ß√£o' },
                { id: 'portas', label: 'Portas' },
                { id: 'janelas', label: 'Janelas' },
                { id: 'vedacao', label: 'Veda√ß√£o' }
            ], baseInspection);

            formHTML += generateChecklist('infra', '7 - Infraestrutura', [
                { id: 'redeAgua', label: 'Conex√£o √† Rede de √Ågua' },
                { id: 'hidrometro', label: 'Hidr√¥metro Individual' },
                { id: 'redeEsgoto', label: 'Conex√£o √† Rede de Esgoto' },
                { id: 'redeEletrica', label: 'Liga√ß√£o com a Rede El√©trica' },
                { id: 'medidor', label: 'Medidor Individual' }
            ], baseInspection);

            formHTML += generateChecklist('outros', '8 - Outros Problemas Identificados', [
                { id: 'outros', label: 'Descrever Outros Problemas' }
            ], baseInspection);

            // CAMPOS ADICIONAIS PARA INSPE√á√ÉO COMPLETA
            if (isCompleta) {
                formHTML += `
                    <div class="form-section" style="border: 3px solid #FF9800;">
                        <h3 style="color: #FF9800;">üìä Campos Adicionais - Inspe√ß√£o Completa</h3>
                        <p style="color: #666; margin-bottom: 20px;">Os campos abaixo s√£o exclusivos da inspe√ß√£o completa</p>
                `;

                // Adicionar campos do checklist 2 que n√£o est√£o na inicial
                formHTML += `
                        <div class="form-group">
                            <label>Observa√ß√µes Gerais da Inspe√ß√£o Completa</label>
                            <textarea id="obsCompleta" placeholder="Adicione observa√ß√µes gerais sobre a inspe√ß√£o completa"></textarea>
                        </div>

                        <h4 style="margin: 20px 0 10px; color: #333;">Avalia√ß√µes Detalhadas</h4>
                        
                        <div class="form-group">
                            <label>Estado Geral da Estrutura</label>
                            <select id="estadoEstrutura">
                                <option value="">Selecione</option>
                                <option value="excelente">Excelente</option>
                                <option value="bom">Bom</option>
                                <option value="regular">Regular</option>
                                <option value="ruim">Ruim</option>
                                <option value="pessimo">P√©ssimo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Estado Geral das Instala√ß√µes El√©tricas</label>
                            <select id="estadoEletrica">
                                <option value="">Selecione</option>
                                <option value="excelente">Excelente</option>
                                <option value="bom">Bom</option>
                                <option value="regular">Regular</option>
                                <option value="ruim">Ruim</option>
                                <option value="pessimo">P√©ssimo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Estado Geral das Instala√ß√µes Hidr√°ulicas</label>
                            <select id="estadoHidraulica">
                                <option value="">Selecione</option>
                                <option value="excelente">Excelente</option>
                                <option value="bom">Bom</option>
                                <option value="regular">Regular</option>
                                <option value="ruim">Ruim</option>
                                <option value="pessimo">P√©ssimo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Necessita Reforma?</label>
                            <select id="necessitaReforma">
                                <option value="nao">N√£o</option>
                                <option value="sim">Sim</option>
                                <option value="urgente">Sim - Urgente</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Estimativa de Custo de Reparos (R$)</label>
                            <input type="number" id="custoReparos" placeholder="0.00" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label>Prazo Estimado para Reparos (dias)</label>
                            <input type="number" id="prazoReparos" placeholder="0" min="0">
                        </div>

                        <div class="form-group">
                            <label>Recomenda√ß√µes T√©cnicas</label>
                            <textarea id="recomendacoes" placeholder="Descreva as recomenda√ß√µes t√©cnicas para o im√≥vel"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Conclus√£o da Inspe√ß√£o</label>
                            <textarea id="conclusao" placeholder="Conclus√£o geral sobre o estado do im√≥vel"></textarea>
                        </div>
                    </div>
                `;
            }

            // Form Actions
            formHTML += `
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="backToMenu()">Cancelar</button>
                    <button class="btn btn-success" onclick="saveInspection()">üíæ Salvar Inspe√ß√£o</button>
                </div>
            `;

            formContainer.innerHTML = formHTML;
            formContainer.classList.add('active');
            document.getElementById('mainMenu').classList.remove('active');

            // Add event listeners for checkboxes
            initializeCheckboxListeners();
        }

        // Generate checklist HTML
        function generateChecklist(category, title, items, baseInspection) {
            let html = `
                <div class="form-section">
                    <div class="checklist-section">
                        <div class="checklist-header">
                            <h4>${title}</h4>
                        </div>
            `;

            items.forEach(item => {
                const itemId = `${category}_${item.id}`;
                const baseValue = baseInspection?.checklist?.[itemId];
                const isChecked = baseValue?.status === 'issue';
                
                html += `
                    <div class="checklist-item">
                        <div class="checklist-item-label">
                            ${item.label}
                            ${item.info ? createInfoIcon(item.info) : ''}
                        </div>
                        <div class="checklist-options">
                            <div class="check-option">
                                <input type="checkbox" 
                                       id="${itemId}" 
                                       ${isChecked ? 'checked' : ''}
                                       onchange="toggleObservation('${itemId}')">
                                <label for="${itemId}">Problema</label>
                            </div>
                        </div>
                    </div>
                    <div class="observation-field ${isChecked ? 'active' : ''}" id="${itemId}_obs">
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #666;">Observa√ß√£o:</label>
                        <textarea id="${itemId}_text" placeholder="Descreva o problema identificado...">${baseValue?.observation || ''}</textarea>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-primary" onclick="addPhoto('${itemId}')" style="font-size: 12px; padding: 8px 15px;">
                                üì∏ Adicionar Foto
                            </button>
                        </div>
                        <div class="photo-preview" id="${itemId}_photos"></div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // Create info icon with tooltip
        function createInfoIcon(infoKey) {
            const info = patologiasInfo[infoKey] || 'Informa√ß√£o n√£o dispon√≠vel';
            return `
                <span class="info-icon">
                    i
                    <span class="tooltip">${info}</span>
                </span>
            `;
        }

        // Get UF options
        function getUFOptions(selectedUF = '') {
            const ufs = ['AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA', 'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN', 'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'];
            return ufs.map(uf => `<option value="${uf}" ${uf === selectedUF ? 'selected' : ''}>${uf}</option>`).join('');
        }

        // Initialize checkbox listeners
        function initializeCheckboxListeners() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    toggleObservation(this.id);
                });
            });
        }

        // Toggle observation field
        function toggleObservation(itemId) {
            const obsField = document.getElementById(`${itemId}_obs`);
            const checkbox = document.getElementById(itemId);
            
            if (checkbox.checked) {
                obsField.classList.add('active');
            } else {
                obsField.classList.remove('active');
            }
        }

        // Add photo
        function addPhoto(itemId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = true;
            
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                
                if (!photoData[itemId]) {
                    photoData[itemId] = [];
                }
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        photoData[itemId].push({
                            data: event.target.result,
                            name: file.name
                        });
                        displayPhotos(itemId);
                    };
                    reader.readAsDataURL(file);
                });
            };
            
            input.click();
        }

        // Display photos
        function displayPhotos(itemId) {
            const container = document.getElementById(`${itemId}_photos`);
            const photos = photoData[itemId] || [];
            
            container.innerHTML = '';
            
            photos.forEach((photo, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                photoDiv.innerHTML = `
                    <img src="${photo.data}" alt="Foto ${index + 1}">
                    <button class="photo-remove" onclick="removePhoto('${itemId}', ${index})">√ó</button>
                `;
                container.appendChild(photoDiv);
            });
        }

        // Remove photo
        function removePhoto(itemId, index) {
            photoData[itemId].splice(index, 1);
            displayPhotos(itemId);
        }

        // Save inspection
        async function saveInspection() {
            if (!validateForm()) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            const inspection = collectFormData();
            
            // Add to inspections array
            inspections.push(inspection);
            saveInspections();

            // Save to Google Drive
            try {
                showProgress('Salvando inspe√ß√£o no Google Drive...');
                await saveToGoogleDrive(inspection);
                hideProgress();
                alert('Inspe√ß√£o salva com sucesso!');
                backToMenu();
            } catch (error) {
                hideProgress();
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar no Google Drive, mas a inspe√ß√£o foi salva localmente.');
            }
        }

        // Validate form
        function validateForm() {
            const requiredFields = ['endereco', 'numero', 'bairro', 'municipio', 'uf', 'dataVistoria', 'horaVistoria', 'acompanhante'];
            
            for (const field of requiredFields) {
                const element = document.getElementById(field);
                if (!element || !element.value.trim()) {
                    return false;
                }
            }
            
            return true;
        }

        // Collect form data
        function collectFormData() {
            const inspection = {
                id: Date.now().toString(),
                type: currentInspectionType,
                baseInspectionId: selectedInitialInspection?.id || null,
                timestamp: new Date().toISOString(),
                endereco: document.getElementById('endereco').value,
                numero: document.getElementById('numero').value,
                complemento: document.getElementById('complemento').value,
                bairro: document.getElementById('bairro').value,
                municipio: document.getElementById('municipio').value,
                uf: document.getElementById('uf').value,
                dataVistoria: document.getElementById('dataVistoria').value,
                horaVistoria: document.getElementById('horaVistoria').value,
                acompanhante: document.getElementById('acompanhante').value,
                idadeImovel: document.getElementById('idadeImovel').value,
                qtdPavimentos: document.getElementById('qtdPavimentos').value,
                qtdSalas: document.getElementById('qtdSalas').value,
                qtdQuartos: document.getElementById('qtdQuartos').value,
                qtdSuites: document.getElementById('qtdSuites').value,
                qtdCozinhas: document.getElementById('qtdCozinhas').value,
                possuiQuintal: document.getElementById('possuiQuintal').value,
                possuiGaragem: document.getElementById('possuiGaragem').value,
                checklist: collectChecklistData(),
                photos: photoData
            };

            // Add complete inspection fields if applicable
            if (currentInspectionType === 'completa') {
                inspection.obsCompleta = document.getElementById('obsCompleta')?.value || '';
                inspection.estadoEstrutura = document.getElementById('estadoEstrutura')?.value || '';
                inspection.estadoEletrica = document.getElementById('estadoEletrica')?.value || '';
                inspection.estadoHidraulica = document.getElementById('estadoHidraulica')?.value || '';
                inspection.necessitaReforma = document.getElementById('necessitaReforma')?.value || '';
                inspection.custoReparos = document.getElementById('custoReparos')?.value || '';
                inspection.prazoReparos = document.getElementById('prazoReparos')?.value || '';
                inspection.recomendacoes = document.getElementById('recomendacoes')?.value || '';
                inspection.conclusao = document.getElementById('conclusao')?.value || '';
            }

            return inspection;
        }

        // Collect checklist data
        function collectChecklistData() {
            const checklist = {};
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                const itemId = checkbox.id;
                const textArea = document.getElementById(`${itemId}_text`);
                
                checklist[itemId] = {
                    status: checkbox.checked ? 'issue' : 'ok',
                    observation: textArea ? textArea.value : ''
                };
            });
            
            return checklist;
        }

        // Save to Google Drive
        async function saveToGoogleDrive(inspection) {
            if (!accessToken) {
                throw new Error('N√£o conectado ao Google Drive');
            }

            // Create folder structure: tipo_inspecao/data/endereco
            const rootFolderName = 'Inspecoes_Residenciais';
            const rootFolderId = await findOrCreateFolder(rootFolderName, null);

            const typeFolderName = inspection.type === 'inicial' ? 'inspecao_inicial' : 'inspecao_completa';
            const typeFolderId = await findOrCreateFolder(typeFolderName, rootFolderId);

            const dateFolder = formatDate(inspection.dataVistoria).replace(/\//g, '-');
            const dateFolderId = await findOrCreateFolder(dateFolder, typeFolderId);

            const addressFolder = `${inspection.endereco}_${inspection.numero}`.replace(/[^a-zA-Z0-9]/g, '_');
            const addressFolderId = await findOrCreateFolder(addressFolder, dateFolderId);

            // Save JSON
            const jsonContent = JSON.stringify(inspection, null, 2);
            await uploadFile(jsonContent, 'inspecao.json', addressFolderId, 'application/json');

            // Save report
            const reportContent = createInspectionReport(inspection);
            await uploadFile(reportContent, 'relatorio.txt', addressFolderId, 'text/plain');

            // Save photos if any
            if (Object.keys(photoData).length > 0) {
                await savePhotos(inspection, addressFolderId);
            }
        }

        // Find or create folder
        async function findOrCreateFolder(folderName, parentId) {
            try {
                // Search for existing folder
                let query = `mimeType='application/vnd.google-apps.folder' and name='${folderName}' and trashed=false`;
                if (parentId) {
                    query += ` and '${parentId}' in parents`;
                }

                const response = await gapi.client.drive.files.list({
                    q: query,
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });

                if (response.result.files && response.result.files.length > 0) {
                    return response.result.files[0].id;
                }

                // Create new folder
                const fileMetadata = {
                    name: folderName,
                    mimeType: 'application/vnd.google-apps.folder'
                };

                if (parentId) {
                    fileMetadata.parents = [parentId];
                }

                const folder = await gapi.client.drive.files.create({
                    resource: fileMetadata,
                    fields: 'id'
                });

                return folder.result.id;
            } catch (error) {
                console.error('Error creating folder:', error);
                throw error;
            }
        }

        // Upload file
        async function uploadFile(content, fileName, folderId, mimeType) {
            const metadata = {
                name: fileName,
                parents: [folderId]
            };

            const file = new Blob([content], { type: mimeType });
            const formData = new FormData();
            formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            formData.append('file', file);

            const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                },
                body: formData
            });

            return response.json();
        }

        // Save photos
        async function savePhotos(inspection, parentFolderId) {
            const photosFolderId = await findOrCreateFolder('fotos', parentFolderId);

            for (const [itemId, photos] of Object.entries(photoData)) {
                if (photos.length > 0) {
                    const itemFolderId = await findOrCreateFolder(itemId, photosFolderId);

                    for (let i = 0; i < photos.length; i++) {
                        const photo = photos[i];
                        const response = await fetch(photo.data);
                        const blob = await response.blob();
                        const fileName = `foto_${i + 1}.jpg`;

                        const metadata = {
                            name: fileName,
                            parents: [itemFolderId]
                        };

                        const formData = new FormData();
                        formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                        formData.append('file', blob);

                        await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            },
                            body: formData
                        });
                    }
                }
            }
        }

        // Create inspection report
        function createInspectionReport(inspection) {
            const typeBadge = inspection.type === 'inicial' ? 'INICIAL' : 'COMPLETA';
            
            let report = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         RELAT√ìRIO DE INSPE√á√ÉO RESIDENCIAL
              TIPO: ${typeBadge}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

DATA E RESPONS√ÅVEL
----------------------------------------------------------
Data da Vistoria: ${formatDate(inspection.dataVistoria)} √†s ${inspection.horaVistoria}
Inspetor: ${inspection.acompanhante}

DADOS DO IM√ìVEL
----------------------------------------------------------
Endere√ßo: ${inspection.endereco}, ${inspection.numero}
${inspection.complemento ? `Complemento: ${inspection.complemento}\n` : ''}Bairro: ${inspection.bairro}
Munic√≠pio: ${inspection.municipio}/${inspection.uf}

CARACTER√çSTICAS
----------------------------------------------------------
Idade do Im√≥vel: ${inspection.idadeImovel || 'N/I'} anos
Pavimentos: ${inspection.qtdPavimentos || 'N/I'}
Salas: ${inspection.qtdSalas || 'N/I'}
Quartos: ${inspection.qtdQuartos || 'N/I'}
Su√≠tes: ${inspection.qtdSuites || 'N/I'}
Cozinhas: ${inspection.qtdCozinhas || 'N/I'}
Quintal: ${inspection.possuiQuintal === 'sim' ? 'Sim' : 'N√£o'}
Garagem: ${inspection.possuiGaragem === 'sim' ? 'Sim' : 'N√£o'}

PROBLEMAS IDENTIFICADOS
----------------------------------------------------------
`;

            let problemCount = 0;
            Object.entries(inspection.checklist).forEach(([key, value]) => {
                if (value.status === 'issue' && value.observation) {
                    problemCount++;
                    const label = key.split('_').slice(1).join(' ').toUpperCase();
                    report += `\n${problemCount}. ${label}\n`;
                    report += `   ${value.observation}\n`;
                }
            });

            if (problemCount === 0) {
                report += '\nNenhum problema foi identificado durante a inspe√ß√£o.\n';
            }

            // Add complete inspection details
            if (inspection.type === 'completa') {
                report += `
\nAVALIA√á√ïES DETALHADAS (INSPE√á√ÉO COMPLETA)
----------------------------------------------------------
Estado Estrutura: ${inspection.estadoEstrutura || 'N/I'}
Estado Instala√ß√µes El√©tricas: ${inspection.estadoEletrica || 'N/I'}
Estado Instala√ß√µes Hidr√°ulicas: ${inspection.estadoHidraulica || 'N/I'}
Necessita Reforma: ${inspection.necessitaReforma || 'N/I'}
Custo Estimado Reparos: R$ ${inspection.custoReparos || '0,00'}
Prazo Estimado: ${inspection.prazoReparos || '0'} dias

RECOMENDA√á√ïES T√âCNICAS:
${inspection.recomendacoes || 'Nenhuma recomenda√ß√£o espec√≠fica.'}

CONCLUS√ÉO:
${inspection.conclusao || 'Sem conclus√£o adicional.'}
`;
            }

            report += `
\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Total de problemas encontrados: ${problemCount}
Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;

            return report;
        }

        // Show progress overlay
        function showProgress(message) {
            const overlay = document.createElement('div');
            overlay.id = 'progressOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
            `;
            overlay.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; text-align: center;">
                    <h3>${message}</h3>
                    <div style="margin: 20px 0;">
                        <div style="width: 200px; height: 4px; background: #e0e0e0; border-radius: 2px; overflow: hidden;">
                            <div style="width: 30%; height: 100%; background: #667eea; animation: progress 2s infinite;"></div>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes progress {
                        0% { width: 30%; }
                        50% { width: 70%; }
                        100% { width: 30%; }
                    }
                </style>
            `;
            document.body.appendChild(overlay);
        }

        function hideProgress() {
            const overlay = document.getElementById('progressOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Back to menu
        function backToMenu() {
            document.getElementById('inspectionForm').classList.remove('active');
            document.getElementById('inspectionForm').innerHTML = '';
            document.getElementById('mainMenu').classList.add('active');
            currentInspection = null;
            currentInspectionType = null;
            selectedInitialInspection = null;
            photoData = {};
        }

        // Show inspections list (placeholder)
        function showInspectionsList() {
            alert('Funcionalidade de listagem em desenvolvimento. As inspe√ß√µes est√£o salvas no Google Drive!');
        }

        // Show settings (placeholder)
        function showSettings() {
            alert('Configura√ß√µes em desenvolvimento.');
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadInspections();
            
            // Inicializar Google Drive automaticamente
            console.log('üîÑ Inicializando Google Drive...');
            initializeGoogleDrive();
        });
    </script>
</body>
</html>
